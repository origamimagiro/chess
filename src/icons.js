import { append_el } from "./utilities.js";

export const build_icons = () => {
    const L = [];
    for (const k of PIECES) {
        const [uri, h, w] = img_cmap_2_dataURI_h_w(ICONS[k], COLORMAP);
        L.push(`.${k} {\n   background-image: url(${uri});\n}`);
    }
    const style = append_el("style", document.head, {innerHTML: L.join("\n")});
};

const img_cmap_2_dataURI_h_w = (img, cmap) => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const L = img.split("\n");
    const h = (canvas.height = L.length);
    const w = (canvas.width = L[0].length);
    const icon = ctx.createImageData(w, h);
    for (let y = 0; y < h; ++y) {
        for (let x = 0; x < w; ++x) {
            const color = cmap[L[y][x]];
            const i = (w*y + x) << 2;
            for (const d of [0, 1, 2, 3]) {
                icon.data[i + d] = color[d];
            }
        }
    }
    ctx.putImageData(icon, 0, 0);
    return [canvas.toDataURL('image/png'), h, w];
};

const COLORMAP = {
    ".": [  0,   0,   0,   0],  // transparent
    ",": [255, 255, 255, 255],  // white
    "#": [  0,   0,   0, 255]   // black
};

const PIECES = "PpBbNnRrQqKk";
const ICONS = {
    P:  // white pawn
`................................
................................
................................
..............####..............
.............##,,##.............
.............#,,,,#.............
.............#,,,,#.............
.............##,,##.............
..............#,,#..............
............###,,###............
...........##,,,,,,##...........
..........##,,,,,,,,##..........
..........#,,,,,,,,,,#..........
..........#,,,,,,,,,,#..........
..........#,,,,,,,,,,#..........
..........##,,,,,,,,##..........
...........##,,,,,,##...........
............##,,,,##............
............##,,,,##............
...........##,,,,,,##...........
..........##,,,,,,,,##..........
.........##,,,,,,,,,,##.........
.........#,,,,,,,,,,,,#.........
........##,,,,,,,,,,,,##........
........#,,,,,,,,,,,,,,#........
.......##,,,,,,,,,,,,,,##.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......##################.......
................................
................................
................................`,
    p:  // black pawn
`................................
................................
................................
..............####..............
.............######.............
.............######.............
.............######.............
.............######.............
..............####..............
............########............
...........##########...........
..........############..........
..........############..........
..........############..........
..........############..........
...........##########...........
............########............
.............######.............
............########............
...........##########...........
..........############..........
.........##############.........
.........##############.........
........################........
........################........
.......##################.......
.......##################.......
.......##################.......
.......##################.......
................................
................................
................................`,
    N:  // white knight
`................................
................................
................................
........#......#................
........###...###...............
........#,##.##,#...............
........#,,###,,#####...........
........#,,##,,,#,,,###.........
.......###,,,,,,,,,,,,##........
......##,,,,,,,,,,,,,,,##.......
......#,,,#,,,,,,,,,,,,,##......
......#,,##,,,,,,,,,,,,,,#......
.....##,,#,,,,,,,#,,,,,,,##.....
.....#,,,,,,,,,,,#,,,,,,,,#.....
....##,,,,,,,,,,##,,,,,,,,##....
....#,,,,,,,,,,,#,,,,,,,,,,#....
...##,,,,,,,,,,##,,,,,,,,,,#....
..##,,,,,,,,,####,,,,,,,,,,##...
..#,,#,,,,,###..#,,,,,,,,,,,#...
..#,,#,,,,##....#,,,,,,,,,,,#...
..##,,,,,##....##,,,,,,,,,,,#...
...#,,#,,#....##,,,,,,,,,,,,#...
...####,##...##,,,,,,,,,,,,,#...
......###...##,,,,,,,,,,,,,,#...
...........##,,,,,,,,,,,,,,,#...
..........##,,,,,,,,,,,,,,,,#...
..........#,,,,,,,,,,,,,,,,,#...
..........#,,,,,,,,,,,,,,,,,#...
..........###################...
................................
................................
................................`,
    n:  // black knight
`................................
................................
................................
........#......#................
........###...###...............
........####.####...............
........#############...........
........##,,,####,,,###.........
.......############,,,##........
......###############,,##.......
......####,###########,,##......
......###,,############,,#......
.....####,#######,#####,,##.....
.....############,#####,,,#.....
....############,,######,,##....
....############,#######,,,#....
...#############,########,,#....
..#######################,,##...
..###,########..#########,,,#...
..###,######....#########,,,#...
..#########....##########,,,#...
...###,###....###########,,,#...
...###,###...############,,,#...
......###...#############,,,#...
...........##############,,,#...
..........###############,,,#...
..........###############,,,#...
..........###############,,,#...
..........###################...
................................
................................
................................`,
    B:  // white bishop
`................................
................................
................................
...............##...............
..............#,,#..............
..............#,,#..............
...............##...............
..............####..............
.............##,,##.............
............##,,,,##............
...........##,,,,,,##...........
..........##,,,##,,,##..........
.........##,,,,##,,,,##.........
.........#,,,######,,,#.........
.........#,,,######,,,#.........
.........#,,,,,##,,,,,#.........
.........#,,,,,##,,,,,#.........
.........##,,,,,,,,,,##.........
..........##,,,,,,,,##..........
...........##########...........
............#,,,,,,#............
...........##,,,,,,##...........
...........#,,,,,,,,#...........
...........##########...........
.............#,,,,#.............
....######..##,,,,##..######....
...##,,,,##############,,,,##...
...#,,,,,,,,,,####,,,,,,,,,,#...
...############..############...
................................
................................
................................`,
    b:  // black bishop
`................................
................................
................................
...............##...............
..............####..............
..............####..............
...............##...............
..............####..............
.............######.............
............########............
...........##########...........
..........#####,,#####..........
.........######,,######.........
.........####,,,,,,####.........
.........####,,,,,,####.........
.........######,,######.........
.........######,,######.........
.........##############.........
..........############..........
...........##########...........
............#,,,,,,#............
...........##,,,,,,##...........
...........##########...........
...........##########...........
.............######.............
....######..##,,,,##..######....
...##########,,,,,,##########...
...##########################...
...############..############...
................................
................................
................................`,
    R:  // white rook
`................................
................................
................................
.......####...####...####.......
.......#,,#...#,,#...#,,#.......
.......#,,#####,,#####,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......##################.......
.........#,,,,,,,,,,,,#.........
.........##,,,,,,,,,,##.........
..........############..........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
..........############..........
.........##,,,,,,,,,,##.........
.........#,,,,,,,,,,,,#.........
........################........
........#,,,,,,,,,,,,,,#........
........#,,,,,,,,,,,,,,#........
.....######################.....
.....#,,,,,,,,,,,,,,,,,,,,#.....
.....#,,,,,,,,,,,,,,,,,,,,#.....
.....######################.....
................................
................................
................................`,
    r:  // black rook
`................................
................................
................................
.......####...####...####.......
.......####...####...####.......
.......##################.......
.......##################.......
.......##################.......
.......##################.......
.........##############.........
.........##,,,,,,,,,,##.........
..........##,,,,,,,,##..........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
..........##,,,,,,,,##..........
.........##,,,,,,,,,,##.........
.........##############.........
........################........
........#,,,,,,,,,,,,,,#........
........#,,,,,,,,,,,,,,#........
.....######################.....
.....######################.....
.....######################.....
.....######################.....
................................
................................
................................`,
    Q:  // white queen
`................................
................................
...............##...............
........##....#,,#....##........
.......#,,#...#,,#...#,,#.......
..##...#,,#....##....#,,#...##..
.#,,#...##.....##.....##...#,,#.
.#,,#...##.....##.....##...#,,#.
..##....###....##....###....##..
..##.....##....##....##.....##..
..###....###..####..###....###..
...###...#,#..#,,#..#,#...###...
...####..#,##.#,,#.##,#..####...
....#,##.#,,#.#,,#.#,,#.##,#....
....#,,###,,###,,###,,###,,#....
....##,,##,,,##,,##,,,##,,##....
.....#,,##,##########,##,,#.....
.....##,,###,,,,,,,,###,,##.....
......####,,,,,,,,,,,,####......
......#,,,,,,,,,,,,,,,,,,#......
......#,,,,##########,,,,#......
......######,,,,,,,,######......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
......##,,,,,,,,,,,,,,,,##......
......#####,,,,,,,,,,#####......
..........############..........
................................
................................`,
    q:  // black queen
`................................
................................
...............##...............
........##....####....##........
.......####...####...####.......
..##...####....##....####...##..
.####...##.....##.....##...####.
.####...##.....##.....##...####.
..##....###....##....###....##..
..##.....##....##....##.....##..
..###....###..####..###....###..
...###...###..####..###...###...
...####..####.####.####..####...
....####.####.####.####.####....
....########################....
....########################....
.....####,,,,,,,,,,,,,,####.....
.....##,,,,,,,,,,,,,,,,,,##.....
......#,,##############,,#......
......####################......
......####,,,,,,,,,,,,####......
......##,,,,,,,,,,,,,,,,##......
.......#,,,##########,,,#.......
.......##################.......
.......####,,,,,,,,,,####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
......####################......
......####################......
..........############..........
................................
................................`,
    K:  // white king
`................................
................................
...............##...............
...............##...............
.............######.............
.............######.............
...............##...............
...............##...............
..............####..............
.............##,,##.............
.....#######.#,,,,#.#######.....
....##,,,,,###,,,,###,,,,,##....
...##,,,,,,,,##,,##,,,,,,,,##...
...#,,,,,,,,,,#,,#,,,,,,,,,,#...
...#,,,,,,,,,,####,,,,,,,,,,#...
...#,,,,,,,,,,,##,,,,,,,,,,,#...
...#,,,,,,,,,,,##,,,,,,,,,,,#...
...##,,,,,,,,,,##,,,,,,,,,,##...
....##,,,,,,,,,##,,,,,,,,,##....
.....##.,,,,,,,##,,,,,,,,##.....
......####################......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
......##,,,,,,,,,,,,,,,,##......
......######,,,,,,,,######......
...........##########...........
................................
................................`,
    k:  // black king
`................................
...............##...............
...............##...............
.............######.............
.............######.............
...............##...............
...............##...............
..............####..............
.............##,,##.............
.....#######.#,##,#.#######.....
....##,,,,,###,##,###,,,,,##....
...##,,###,,,##,,##,,,###,,##...
...#,,######,,#,,#,,######,,#...
...#,########,####,########,#...
...#,########,,##,,########,#...
...#,,########,##,########,,#...
...##,,#######,##,#######,,##...
....##,,######,##,######,,##....
.....##,,,,,,,,##,,,,,,,,##.....
......####################......
.......###,,,,,,,,,,,,###.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......##################.......
.......####,,,,,,,,,,####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
......####################......
......####################......
..........############..........
................................
................................`,
};
