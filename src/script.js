const last = (A) => A[A.length - 1];

const append_el = (tag, par, attributes = {}) => {
    const el = document.createElement(tag);
    for (const [k, v] of Object.entries(attributes)) { el[k] = v; }
    par.appendChild(el);
    return el;
};

const START = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";

window.onload = () => {
    const style = document.createElement("style");
    const L = [];
    for (const k of PIECES) {
        const [uri, h, w] = img_cmap_2_dataURI_h_w(ICONS[k], COLORMAP);
        L.push(`.${k} {\n   background-image: url(${uri});\n}`);
    }
    style.innerHTML = L.join("\n");
    document.head.appendChild(style);
    const B = document.body;
    const board = append_el("div", B, {id: "board"});
    const data = append_el("textarea", B, {rows: 1, cols: 80,   id: "data"});
    const reset  = append_el("button", B, {innerHTML: "Reset",  id: "reset"});
    const undo   = append_el("button", B, {innerHTML: "Undo",   id: "undo"});
    const dump   = append_el("button", B, {innerHTML: "Dump",   id: "dump"});
    const submit = append_el("button", B, {innerHTML: "Submit", id: "submit"});
    const states = [FEN_2_state(START)];
    const gui = {data,
        board_divs: undefined, taken_divs: undefined,
        taken: {w: [], b: []}, active: undefined, promotion: false,
        moves: Array(8).fill().map(() => Array(8).fill().map(() => [])),
    };
    gui.board_divs = Array(8).fill().map((_, y) =>
        Array(8).fill().map((_, x) => {
            const div = append_el("div", board, {id: `B${x},${y}`});
            div.style.top = `${y * 32}px`;
            div.style.left = `${x * 32}px`;
            div.onclick = () => click_square(x, y, states, gui);
            return div;
        })
    );
    const taken = append_el("div", B, {id: "taken"});
    gui.taken_divs = Object.fromEntries(['w', 'b'].map((c, i) => [c,
        Array(16).fill().map((_, j) => {
            const div = append_el("div", taken, {id: `T${c}${j}`});
            div.style.top  = `${i * 16}px`;
            div.style.left = `${j * 16}px`;
            return div;
        })
    ]));
    reset.onclick = () => {
        const state = FEN_2_state(START);
        states.length = 0;
        states.push(state);
        gui.taken.w = [];
        gui.taken.b = [];
        gui.active = undefined;
        gui.promotion = false;
        update(state, gui);
    }
    undo.onclick = () => {
        if (states.length == 1) { return; }
        const p = states.pop().taken;
        if (p != undefined) {
            const c = p_2_color(p);
            gui.taken[c].splice(gui.taken[c].indexOf(p), 1);
        }
        active = undefined;
        const state = last(states);
        update(state, gui);
    };
    dump.onclick = () => {
        console.log("States", states);
        console.log("GUI", gui);
    };
    submit.onclick = () => {
        const state = FEN_2_state(data.value);
        if (state != undefined) {
            states.length = 0;
            states.push(state);
        }
        update(last(states), gui);
    };
    update(last(states), gui);
};

const is_capture = (move) => ((move[1] != undefined) && (move[2] == undefined));

const filter_moves = (board, turn, sx, sy, moves) => {
    const B = Array(8).fill().map(() => Array(8).fill());
    return moves.filter((move) => {
        copy_board(board, B);
        make_move(sx, sy, move, B);
        const A = attacked(B, turn);
        for (let ky = 0; ky < 8; ++ky) {
            for (let kx = 0; kx < 8; ++kx) {
                const p = B[ky][kx];
                const c = p_2_color(p);
                const t = p_2_type(p);
                if ((c != turn) || (t != 'K')) { continue; }
                return !A[ky][kx];
            }
        }
        return true;
    });
};

const update = (state, gui) => {
    const {board, turn, castle, enpassant} = state;
    const A = attacked(board, turn);
    const kings = {b: undefined, w: undefined};
    let stale = true, pieces = 0;
    for (let y = 0; y < 8; ++y) {
        for (let x = 0; x < 8; ++x) {
            const p = board[y][x];
            if (p == '.') { continue; }
            pieces += 1;
            const c = p_2_color(p);
            const t = p_2_type(p);
            if (t == 'K') { kings[c] = [x, y]; }
            if (c != turn) { gui.moves[y][x] = []; continue; }
            const raw = accessible_moves(x, y, board, enpassant, castle, A);
            const moves = filter_moves(board, turn, x, y, raw);
            if (moves.length > 0) { stale = false; }
            gui.moves[y][x] = moves;
        }
    }
    if (pieces == 2) {
        stale = true;
        for (const c of ['w', 'b']) {
            const [kx, ky] = kings[c];
            gui.moves[ky][kx] = [];
        }
    }
    const [kx, ky] = kings[turn];
    gui.status = (A[ky][kx]
        ? (stale ? "checkmate" : "check")
        : (stale ? "stalemate" : "normal")
    );
    for (let y = 0; y < 8; ++y) {
        for (let x = 0; x < 8; ++x) {
            const div = gui.board_divs[y][x];
            div.className = '';
            div.classList.add("square");
            div.classList.add(((x + y) % 2) ? "light" : "dark");
            const p = board[y][x];
            if (p != '.') { div.classList.add(p); }
            if ((p_2_type(p) == 'K') &&
                (gui.status != "normal") &&
                ((gui.status == "stalemate") || (p_2_color(p) == turn))
            ) {
                div.classList.add(gui.status);
            }
        }
    }
    for (const c of ['w', 'b']) {
        const taken = gui.taken[c];
        for (let i = 0; i < 16; ++i) {
            gui.taken_divs[c][i].className = '';
            gui.taken_divs[c][i].classList.add("took");
        }
        for (let i = 0; i < taken.length; ++i) {
            const p = taken[i];
            gui.taken_divs[c][i].classList.add(p);
        }
    }
    if (gui.active != undefined) {
        const [x, y] = gui.active;
        if (gui.promotion) {
            gui.board_divs[y][x].classList.add("move");
        } else {
            gui.board_divs[y][x].classList.add("active");
            for (const move of gui.moves[y][x]) {
                const [mx, my] = move[0];
                gui.board_divs[my][mx].classList.add(
                    is_capture(move) ? "take" : "move");
            }
        }
    }
    gui.data.value = state_2_FEN(state);
};

const copy_board = (B1, B2) => {
    for (let y = 0; y < 8; ++y) {
        for (let x = 0; x < 8; ++x) {
            B2[y][x] = B1[y][x];
        }
    }
};

const attacked = (board, turn) => {
    const b = (turn == 'w') ? 'b' : 'w';
    const A = Array(8).fill().map(() => Array(8).fill(0));
    for (let y = 0; y < 8; ++y) {
        for (let x = 0; x < 8; ++x) {
            const p = board[y][x];
            if (p_2_color(p) != b) { continue; }
            const t = p_2_type(p);
            const moves = accessible_moves(x, y, board);
            for (const move of moves) {
                const [dx, dy] = move[0];
                if ((t == 'P') && (x == dx)) { continue; }
                A[dy][dx] = 1;
            }
        }
    }
    return A;
};

const make_move = (sx, sy, move, board) => {
    const [dx, dy] = move[0];
    if (move[2] != undefined) { // castle
        const [rx, ry] = move[1];
        const [drx, dry] = move[2];
        board[dry][drx] = board[ry][rx];
        board[ry][rx] = '.';
    } else if (move[1] != undefined) { // capture
        const [cx, cy] = move[1];
        board[cy][cx] = '.';
    }
    board[dy][dx] = board[sy][sx];
    board[sy][sx] = '.';
};

const ORDER = {p: 1, n: 2, b: 3, r: 4, q: 5, P: 1, N: 2, B: 3, R: 4, Q: 5};
const PROMO_MAP = {
    Q: "R", R: "B", B: "N", N: "Q",
    q: "r", r: "b", b: "n", n: "q",
};

const click_square = (x, y, states, gui) => {
    const state = states[states.length - 1];
    if (gui.promotion) {
        const [ax, ay] = gui.active;
        if ((x == ax) && (y == ay)) {
            state.board[y][x] = PROMO_MAP[state.board[y][x]];
        } else {
            gui.promotion = false;
            gui.active = undefined;
        }
        update(last(states), gui);
        return;
    }
    if (gui.active == undefined) {
        const p = state.board[y][x];
        const c = p_2_color(p);
        if (c != state.turn) { return; }
        gui.active = [x, y];
    } else {
        const [sx, sy] = gui.active;
        for (const m of gui.moves[sy][sx]) {
            const [dx, dy] = m[0];
            if ((x == dx) && (y == dy)) {
                const board = Array(8).fill().map(() => Array(8).fill("."));
                copy_board(state.board, board);
                const t = p_2_type(board[sy][sx]);
                const enpassant = ((t == 'P') && (Math.abs(dy - sy) == 2))
                    ? [dx, dy] : undefined;
                const halfmove = ((t == 'P') || is_capture(m))
                    ? 0 : (state.halfmove + 1);
                const castle = FENcastle_2_castle(
                    castle_2_FENcastle(state.castle));
                for (const [s, x] of [[0, 7], [1, 0]]) {
                    if (castle[state.turn][s] && ((t == 'K') || (
                        (sx == x) && (sy == ((state.turn == 'w') ? 7 : 0))
                    ))) { castle[state.turn][s] = false; }
                }
                let taken = undefined;
                if (is_capture(m)) {
                    const [cx, cy] = m[1];
                    const p = state.board[cy][cx];
                    const c = p_2_color(p);
                    gui.taken[c].push(p);
                    gui.taken[c].sort((a, b) => ORDER[a] - ORDER[b]);
                    taken = p;
                }
                make_move(sx, sy, m, board);
                if ((t == 'P') && ((dy % 7) == 0)) {
                    board[dy][dx] = (state.turn == 'w') ? 'Q' : 'q';
                    gui.promotion = true;
                    gui.active = [dx, dy];
                }
                const turn = (state.turn == 'w') ? 'b' : 'w';
                const move = state.move + ((turn == 'w') ? 1 : 0);
                states.push({board, turn, castle,
                    enpassant, halfmove, move, taken});
                break;
            }
        }
        if (!gui.promotion) { gui.active = undefined; }
    }
    update(last(states), gui);
};

const x_2_f = (x) => String.fromCodePoint('a'.charCodeAt(0) + x);
const f_2_x = (f) => f.charCodeAt(0) - 'a'.charCodeAt(0);
const y_2_r = (y) => 8 - y;
const r_2_y = (r) => 8 - Number(r);
const xy_2_sq = (x, y) => [x_2_f(x), y_2_r(y)].join("");
const sq_2_xy = (sq) => [f_2_x(sq[0]), r_2_y(sq[1])];
const p_2_color = (p) => ((p >= 'a') ? 'b' : ((p >= 'A') ? 'w' : '.'));
const p_2_type  = (p) => (p == '.') ? '.' : p.toUpperCase();

const FEN_2_state = (FEN) => {
    const board = Array(8).fill().map(() => Array(8).fill("."));
    const components = FEN.split(" ");
    if (components.length != 6) {
        console.log("FEN does not have correct number of fields");
        return;
    }
    const [B, turn, c, e, h, m] = components;
    if ((turn != 'b') && (turn != 'w')) {
        console.log("FEN turn field malformed");
        return;
    }
    if ((e != '-') && ((e.length != 2) ||
        (e[0] < 'a') || (e[0] > 'h') || (e[1] < '1') || (e[1] > '8')
    )) {
        console.log("FEN enpassant field malformed");
        return;
    }
    const enpassant = (e == "-") ? undefined : sq_2_xy(e);
    if (c != '-') {
        for (const a of c) {
            if (!("KQkq".includes(a))) {
                console.log("FEN castle field malformed");
                return;
            }
        }
    }
    const castle = FENcastle_2_castle(c);
    const halfmove = parseInt(h), move = parseInt(m);
    if (isNaN(halfmove)) {
        console.log("FEN halfmove field malformed");
        return;
    }
    if (isNaN(move)) {
        console.log("FEN move field malformed");
        return;
    }
    const R = B.split("/");
    if (R.length != 8) {
        console.log("FEN board data does not have 8 rows");
        return;
    }
    for (let i = 0; i < 8; ++i) {
        let j = 0;
        for (const c of R[i]) {
            if (('0' <= c) && (c <= '9')) {
                j += (c - '0');
            } else if ('PpNnBbRrQqKk'.includes(c)){
                board[i][j] = c;
                ++j;
            } else {
                console.log("FEN board data contains invalid character");
                return;
            }
        }
        if (j != 8) {
            console.log("FEN board row data too much or not enough");
            return;
        }
    }
    const taken = undefined;
    return {board, turn, castle, enpassant, halfmove, move, taken};
}

const FENcastle_2_castle = (c) => { return {
    w: Array.from("KQ").map(v => c.includes(v)),
    b: Array.from("kq").map(v => c.includes(v)),
}; }

const castle_2_FENcastle = (castle) => {
    const c = [
        castle.w[0] ? 'K' : '', castle.w[1] ? 'Q' : '',
        castle.b[0] ? 'k' : '', castle.b[1] ? 'q' : '',
    ].join("");
    return (c == '') ? '-' : c;
}

const state_2_FEN = (state) => {
    const {board, turn, castle, enpassant, halfmove, move} = state;
    const e = (!enpassant) ? '-' : xy_2_sq(enpassant[0], enpassant[1]);
    const c = castle_2_FENcastle(castle);
    const B = [];
    for (let i = 0; i < 8; ++i) {
        if (i > 0) { B.push("/"); }
        let k = 0;
        for (let j = 0; j < 8; ++j) {
            const b = board[i][j];
            if (b == '.') {
                ++k;
            } else {
                if (k != 0) { B.push(k); k = 0; }
                B.push(b);
            }
        }
        if (k != 0) { B.push(k); }
    }
    return [B.join(""), turn, c, e, halfmove, move].join(" ");
}

const MOVES = {
    N: [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]],
    K: [[-1,-1],[-1,1],[1,-1],[1,1],[0,-1],[-1,0],[0,1],[1,0]],
    R: [[-1,0],[1,0],[0,-1],[0,1]],
    B: [[-1,-1],[1,-1],[-1,1],[1,1]],
    Q: [[-1,-1],[1,-1],[-1,1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],
};

const accessible_moves = (x, y, board, enpassant, castle, A) => {
    const p = board[y][x];
    const w = p_2_color(p);
    const b = (w == 'w') ? 'b' : 'w';
    const t = p_2_type(p);
    const out = [];
    switch (t) {
        case 'P':
            if ((y % 7) == 0) { console.log("ERROR: pawn on rank 1 or 8"); }
            const dy = (w == 'w') ? -1 : 1;
            const y1 = y + dy;
            if ((board[y1][x] == '.') && (A != undefined)) {
                out.push([[x, y1]]);
                if ((y == ((w == 'w') ? 6 : 1)) && (board[y1 + dy][x] == '.')) {
                    out.push([[x, y1 + dy]]);
                }
            }
            for (const [x1, lim] of [[x - 1, -1], [x + 1, 8]]) {
                if (x1 == lim) { continue; }
                const p1 = board[y1][x1];
                if ((A != undefined) && (p_2_color(p1) != b)) { continue; }
                out.push([[x1, y1], [x1, y1]]);
            }
            if (enpassant != undefined) {
                const [ex, ey] = enpassant;
                if ((y == ((w == 'w') ? 3 : 4)) && (Math.abs(x - ex) == 1)) {
                    out.push([[ex, y1], [ex, y]]);
                }
            }
            break;
        case 'K':
            if (castle != undefined) {
                if ((board[y][5] == '.') &&
                    (board[y][6] == '.') && castle[w][0] &&
                    ((A == undefined) || (!A[y][4] && !A[y][5] && !A[y][6]))
                ) {
                    out.push([[6, y], [7, y], [5, y]]);
                }
                if ((board[y][1] == '.') &&
                    (board[y][2] == '.') &&
                    (board[y][3] == '.') && castle[w][1] &&
                    ((A == undefined) || (!A[y][2] && !A[y][3] && !A[y][4]))
                ) {
                    out.push([[2, y], [0, y], [3, y]]);
                }
            } // fallthrough
        case 'N':
            for (const [dx, dy] of MOVES[t]) {
                const x1 = x + dx; if ((x1 < 0) || (x1 > 7)) { continue; }
                const y1 = y + dy; if ((y1 < 0) || (y1 > 7)) { continue; }
                const c = p_2_color(board[y1][x1]);
                if (c == w) { continue; }
                if ((t == 'K') && (A != undefined) && A[y1][x1]) { continue; }
                out.push((c == b) ? [[x1, y1], [x1, y1]] : [[x1, y1]]);
            }
            break;
        case 'Q': case 'B': case 'R':
            for (const [dx, dy] of MOVES[t]) {
                for (let x1 = x + dx, y1 = y + dy;
                    ((x1 + 1) % 9) && ((y1 + 1) % 9); x1 += dx, y1 += dy
                ) {
                    const c1 = p_2_color(board[y1][x1]);
                    if (c1 == '.') { out.push([[x1, y1]]); continue; }
                    if (c1 != w)   { out.push([[x1, y1], [x1, y1]]); }
                    break;
                }
            }
    }
    return out;
};

const img_cmap_2_dataURI_h_w = (img, cmap) => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const L = img.split("\n");
    const h = (canvas.height = L.length);
    const w = (canvas.width = L[0].length);
    const icon = ctx.createImageData(w, h);
    for (let y = 0; y < h; ++y) {
        for (let x = 0; x < w; ++x) {
            const color = cmap[L[y][x]];
            const i = (w*y + x) << 2;
            for (const d of [0, 1, 2, 3]) {
                icon.data[i + d] = color[d];
            }
        }
    }
    ctx.putImageData(icon, 0, 0);
    return [canvas.toDataURL('image/png'), h, w];
};

const COLORMAP = {
    ".": [  0,   0,   0,   0],  // transparent
    ",": [255, 255, 255, 255],  // white
    "#": [  0,   0,   0, 255]   // black
};

const PIECES = "PpBbNnRrQqKk";
const ICONS = {
    P:  // white pawn
`................................
................................
................................
..............####..............
.............##,,##.............
.............#,,,,#.............
.............#,,,,#.............
.............##,,##.............
..............#,,#..............
............###,,###............
...........##,,,,,,##...........
..........##,,,,,,,,##..........
..........#,,,,,,,,,,#..........
..........#,,,,,,,,,,#..........
..........#,,,,,,,,,,#..........
..........##,,,,,,,,##..........
...........##,,,,,,##...........
............##,,,,##............
............##,,,,##............
...........##,,,,,,##...........
..........##,,,,,,,,##..........
.........##,,,,,,,,,,##.........
.........#,,,,,,,,,,,,#.........
........##,,,,,,,,,,,,##........
........#,,,,,,,,,,,,,,#........
.......##,,,,,,,,,,,,,,##.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......##################.......
................................
................................
................................`,
    p:  // black pawn
`................................
................................
................................
..............####..............
.............######.............
.............######.............
.............######.............
.............######.............
..............####..............
............########............
...........##########...........
..........############..........
..........############..........
..........############..........
..........############..........
...........##########...........
............########............
.............######.............
............########............
...........##########...........
..........############..........
.........##############.........
.........##############.........
........################........
........################........
.......##################.......
.......##################.......
.......##################.......
.......##################.......
................................
................................
................................`,
    N:  // white knight
`................................
................................
................................
........#......#................
........###...###...............
........#,##.##,#...............
........#,,###,,#####...........
........#,,##,,,#,,,###.........
.......###,,,,,,,,,,,,##........
......##,,,,,,,,,,,,,,,##.......
......#,,,#,,,,,,,,,,,,,##......
......#,,##,,,,,,,,,,,,,,#......
.....##,,#,,,,,,,#,,,,,,,##.....
.....#,,,,,,,,,,,#,,,,,,,,#.....
....##,,,,,,,,,,##,,,,,,,,##....
....#,,,,,,,,,,,#,,,,,,,,,,#....
...##,,,,,,,,,,##,,,,,,,,,,#....
..##,,,,,,,,,####,,,,,,,,,,##...
..#,,#,,,,,###..#,,,,,,,,,,,#...
..#,,#,,,,##....#,,,,,,,,,,,#...
..##,,,,,##....##,,,,,,,,,,,#...
...#,,#,,#....##,,,,,,,,,,,,#...
...####,##...##,,,,,,,,,,,,,#...
......###...##,,,,,,,,,,,,,,#...
...........##,,,,,,,,,,,,,,,#...
..........##,,,,,,,,,,,,,,,,#...
..........#,,,,,,,,,,,,,,,,,#...
..........#,,,,,,,,,,,,,,,,,#...
..........###################...
................................
................................
................................`,
    n:  // black knight
`................................
................................
................................
........#......#................
........###...###...............
........####.####...............
........#############...........
........##,,,####,,,###.........
.......############,,,##........
......###############,,##.......
......####,###########,,##......
......###,,############,,#......
.....####,#######,#####,,##.....
.....############,#####,,,#.....
....############,,######,,##....
....############,#######,,,#....
...#############,########,,#....
..#######################,,##...
..###,########..#########,,,#...
..###,######....#########,,,#...
..#########....##########,,,#...
...###,###....###########,,,#...
...###,###...############,,,#...
......###...#############,,,#...
...........##############,,,#...
..........###############,,,#...
..........###############,,,#...
..........###############,,,#...
..........###################...
................................
................................
................................`,
    B:  // white bishop
`................................
................................
................................
...............##...............
..............#,,#..............
..............#,,#..............
...............##...............
..............####..............
.............##,,##.............
............##,,,,##............
...........##,,,,,,##...........
..........##,,,##,,,##..........
.........##,,,,##,,,,##.........
.........#,,,######,,,#.........
.........#,,,######,,,#.........
.........#,,,,,##,,,,,#.........
.........#,,,,,##,,,,,#.........
.........##,,,,,,,,,,##.........
..........##,,,,,,,,##..........
...........##########...........
............#,,,,,,#............
...........##,,,,,,##...........
...........#,,,,,,,,#...........
...........##########...........
.............#,,,,#.............
....######..##,,,,##..######....
...##,,,,##############,,,,##...
...#,,,,,,,,,,####,,,,,,,,,,#...
...############..############...
................................
................................
................................`,
    b:  // black bishop
`................................
................................
................................
...............##...............
..............####..............
..............####..............
...............##...............
..............####..............
.............######.............
............########............
...........##########...........
..........#####,,#####..........
.........######,,######.........
.........####,,,,,,####.........
.........####,,,,,,####.........
.........######,,######.........
.........######,,######.........
.........##############.........
..........############..........
...........##########...........
............#,,,,,,#............
...........##,,,,,,##...........
...........##########...........
...........##########...........
.............######.............
....######..##,,,,##..######....
...##########,,,,,,##########...
...##########################...
...############..############...
................................
................................
................................`,
    R:  // white rook
`................................
................................
................................
.......####...####...####.......
.......#,,#...#,,#...#,,#.......
.......#,,#####,,#####,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......##################.......
.........#,,,,,,,,,,,,#.........
.........##,,,,,,,,,,##.........
..........############..........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
...........#,,,,,,,,#...........
..........############..........
.........##,,,,,,,,,,##.........
.........#,,,,,,,,,,,,#.........
........################........
........#,,,,,,,,,,,,,,#........
........#,,,,,,,,,,,,,,#........
.....######################.....
.....#,,,,,,,,,,,,,,,,,,,,#.....
.....#,,,,,,,,,,,,,,,,,,,,#.....
.....######################.....
................................
................................
................................`,
    r:  // black rook
`................................
................................
................................
.......####...####...####.......
.......####...####...####.......
.......##################.......
.......##################.......
.......##################.......
.......##################.......
.........##############.........
.........##,,,,,,,,,,##.........
..........##,,,,,,,,##..........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
...........##########...........
..........##,,,,,,,,##..........
.........##,,,,,,,,,,##.........
.........##############.........
........################........
........#,,,,,,,,,,,,,,#........
........#,,,,,,,,,,,,,,#........
.....######################.....
.....######################.....
.....######################.....
.....######################.....
................................
................................
................................`,
    Q:  // white queen
`................................
................................
...............##...............
........##....#,,#....##........
.......#,,#...#,,#...#,,#.......
..##...#,,#....##....#,,#...##..
.#,,#...##.....##.....##...#,,#.
.#,,#...##.....##.....##...#,,#.
..##....###....##....###....##..
..##.....##....##....##.....##..
..###....###..####..###....###..
...###...#,#..#,,#..#,#...###...
...####..#,##.#,,#.##,#..####...
....#,##.#,,#.#,,#.#,,#.##,#....
....#,,###,,###,,###,,###,,#....
....##,,##,,,##,,##,,,##,,##....
.....#,,##,##########,##,,#.....
.....##,,###,,,,,,,,###,,##.....
......####,,,,,,,,,,,,####......
......#,,,,,,,,,,,,,,,,,,#......
......#,,,,##########,,,,#......
......######,,,,,,,,######......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
......##,,,,,,,,,,,,,,,,##......
......#####,,,,,,,,,,#####......
..........############..........
................................
................................`,
    q:  // black queen
`................................
................................
...............##...............
........##....####....##........
.......####...####...####.......
..##...####....##....####...##..
.####...##.....##.....##...####.
.####...##.....##.....##...####.
..##....###....##....###....##..
..##.....##....##....##.....##..
..###....###..####..###....###..
...###...###..####..###...###...
...####..####.####.####..####...
....####.####.####.####.####....
....########################....
....########################....
.....####,,,,,,,,,,,,,,####.....
.....##,,,,,,,,,,,,,,,,,,##.....
......#,,##############,,#......
......####################......
......####,,,,,,,,,,,,####......
......##,,,,,,,,,,,,,,,,##......
.......#,,,##########,,,#.......
.......##################.......
.......####,,,,,,,,,,####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
......####################......
......####################......
..........############..........
................................
................................`,
    K:  // white king
`................................
................................
...............##...............
...............##...............
.............######.............
.............######.............
...............##...............
...............##...............
..............####..............
.............##,,##.............
.....#######.#,,,,#.#######.....
....##,,,,,###,,,,###,,,,,##....
...##,,,,,,,,##,,##,,,,,,,,##...
...#,,,,,,,,,,#,,#,,,,,,,,,,#...
...#,,,,,,,,,,####,,,,,,,,,,#...
...#,,,,,,,,,,,##,,,,,,,,,,,#...
...#,,,,,,,,,,,##,,,,,,,,,,,#...
...##,,,,,,,,,,##,,,,,,,,,,##...
....##,,,,,,,,,##,,,,,,,,,##....
.....##.,,,,,,,##,,,,,,,,##.....
......####################......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......#####,,,,,,,,#####.......
.......#,,,,,,,,,,,,,,,,#.......
......##,,,,,,,,,,,,,,,,##......
......######,,,,,,,,######......
...........##########...........
................................
................................`,
    k:  // black king
`................................
...............##...............
...............##...............
.............######.............
.............######.............
...............##...............
...............##...............
..............####..............
.............##,,##.............
.....#######.#,##,#.#######.....
....##,,,,,###,##,###,,,,,##....
...##,,###,,,##,,##,,,###,,##...
...#,,######,,#,,#,,######,,#...
...#,########,####,########,#...
...#,########,,##,,########,#...
...#,,########,##,########,,#...
...##,,#######,##,#######,,##...
....##,,######,##,######,,##....
.....##,,,,,,,,##,,,,,,,,##.....
......####################......
.......###,,,,,,,,,,,,###.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
.......##################.......
.......####,,,,,,,,,,####.......
.......#,,,,,,,,,,,,,,,,#.......
.......#,,,##########,,,#.......
......####################......
......####################......
..........############..........
................................
................................`,
};
